---
import "../styles/global.css";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Local Galaxy - Andromeda</title>
  </head>
  <body>
    <main class="galaxy-page">
        <div class="galaxy-header">
            <h1>Local Stellar Neighborhood</h1>
            <p>Explore nearby star systems within 10 light-years of Earth</p>
        </div>
        
        <div class="galaxy-container">
            <div id="galaxy-renderer"></div>
            <div class="galaxy-controls">
                <div class="control-panel">
                    <h3>Galaxy Controls</h3>
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="enable-animations" checked>
                            Enable Animations
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="enable-star-glow" checked>
                            Star Glow Effects
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="enable-labels" checked>
                            Star System Labels
                        </label>
                    </div>
                    <div class="control-group">
                        <label for="render-distance">Max Render Distance:</label>
                        <input type="range" id="render-distance" min="10" max="100" value="50">
                        <span id="distance-value">50 ly</span>
                    </div>
                </div>
                
                <div class="star-systems-list">
                    <h3>Star Systems</h3>
                    <div class="system-list">
                        <button class="system-button" data-system="solar-system">
                            <span class="system-name">Solar System</span>
                            <span class="system-distance">0.0 ly</span>
                        </button>
                        <button class="system-button" data-system="alpha-centauri">
                            <span class="system-name">Alpha Centauri</span>
                            <span class="system-distance">4.37 ly</span>
                        </button>
                        <button class="system-button" data-system="barnards-star">
                            <span class="system-name">Barnard's Star</span>
                            <span class="system-distance">5.96 ly</span>
                        </button>
                        <button class="system-button" data-system="wolf-359">
                            <span class="system-name">Wolf 359</span>
                            <span class="system-distance">7.86 ly</span>
                        </button>
                        <button class="system-button" data-system="sirius">
                            <span class="system-name">Sirius</span>
                            <span class="system-distance">8.66 ly</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="galaxy-info">
            <div class="info-section">
                <h2>About the Local Stellar Neighborhood</h2>
                <p>
                    This 3D visualization shows the nearest star systems to Earth within approximately 10 light-years.
                    Each star system is positioned according to its actual location in space, giving you a sense
                    of the true 3D structure of our local galactic region.
                </p>
                <ul>
                    <li><strong>Solar System:</strong> Our home, located at the center of this view</li>
                    <li><strong>Alpha Centauri:</strong> The closest star system, a triple star system</li>
                    <li><strong>Barnard's Star:</strong> A red dwarf with high proper motion</li>
                    <li><strong>Wolf 359:</strong> A red dwarf flare star</li>
                    <li><strong>Sirius:</strong> The brightest star in Earth's night sky</li>
                </ul>
            </div>
            
            <div class="info-section">
                <h2>Navigation Tips</h2>
                <ul>
                    <li><strong>Mouse/Touch:</strong> Drag to rotate the view</li>
                    <li><strong>Scroll/Pinch:</strong> Zoom in and out</li>
                    <li><strong>Star Systems:</strong> Click on systems in the list to focus on them</li>
                    <li><strong>Controls:</strong> Use the panel to adjust visual settings</li>
                </ul>
            </div>
        </div>
    </main>
</Layout>

<script>
    import { GalaxyRenderer, localGalaxyData } from '../lib/galaxy/index.js';
    
    let galaxyRenderer = null;
    
    // Initialize the galaxy renderer when the page loads
    document.addEventListener('DOMContentLoaded', async () => {
        const container = document.getElementById('galaxy-renderer');
        if (!container) return;
        
        try {
            // Configure the galaxy renderer
            const config = {
                enableControls: true,
                enableAnimations: true,
                enableStarGlow: true,
                enableStarLabels: true,
                maxRenderDistance: 50,
                performanceMode: 'medium',
                backgroundStarCount: 2000
            };
            
            const events = {
                onSystemLoad: () => {
                    console.log('Galaxy loaded successfully');
                },
                onError: (error) => {
                    console.error('Galaxy error:', error);
                },
                onStarSystemSelect: (system) => {
                    console.log('Selected system:', system.name);
                }
            };
            
            // Create and initialize renderer
            galaxyRenderer = new GalaxyRenderer(container, config, events);
            await galaxyRenderer.initialize(localGalaxyData);
            
            // Setup controls
            setupControls();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                if (galaxyRenderer) {
                    galaxyRenderer.onResize();
                }
            });
            
        } catch (error) {
            console.error('Failed to initialize galaxy:', error);
        }
    });
    
    // Setup control panel interactions
    function setupControls() {
        // Animation toggle
        const animationsCheckbox = document.getElementById('enable-animations');
        if (animationsCheckbox) {
            animationsCheckbox.addEventListener('change', (e) => {
                if (galaxyRenderer && e.target) {
                    galaxyRenderer.updateConfig({ enableAnimations: e.target.checked });
                }
            });
        }
        
        // Star glow toggle
        const glowCheckbox = document.getElementById('enable-star-glow');
        if (glowCheckbox) {
            glowCheckbox.addEventListener('change', (e) => {
                if (galaxyRenderer && e.target) {
                    galaxyRenderer.updateConfig({ enableStarGlow: e.target.checked });
                }
            });
        }
        
        // Labels toggle
        const labelsCheckbox = document.getElementById('enable-labels');
        if (labelsCheckbox) {
            labelsCheckbox.addEventListener('change', (e) => {
                if (galaxyRenderer && e.target) {
                    galaxyRenderer.updateConfig({ enableStarLabels: e.target.checked });
                }
            });
        }
        
        // Render distance slider
        const distanceSlider = document.getElementById('render-distance');
        const distanceValue = document.getElementById('distance-value');
        if (distanceSlider && distanceValue) {
            distanceSlider.addEventListener('input', (e) => {
                if (e.target) {
                    const value = parseInt(e.target.value);
                    distanceValue.textContent = `${value} ly`;
                    if (galaxyRenderer) {
                        galaxyRenderer.updateConfig({ maxRenderDistance: value });
                    }
                }
            });
        }
        
        // Star system buttons
        const systemButtons = document.querySelectorAll('.system-button');
        systemButtons.forEach(button => {
            button.addEventListener('click', () => {
                const systemId = button.getAttribute('data-system');
                if (systemId && galaxyRenderer) {
                    galaxyRenderer.focusOnStarSystem(systemId, true);
                    galaxyRenderer.highlightStarSystem(systemId, true);
                    
                    // Remove highlight from other systems
                    systemButtons.forEach(otherButton => {
                        if (otherButton !== button) {
                            const otherSystemId = otherButton.getAttribute('data-system');
                            if (otherSystemId && galaxyRenderer) {
                                galaxyRenderer.highlightStarSystem(otherSystemId, false);
                            }
                            otherButton.classList.remove('active');
                        }
                    });
                    
                    button.classList.add('active');
                }
            });
        });
    }
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
        if (galaxyRenderer) {
            galaxyRenderer.dispose();
        }
    });
</script>

<style>
    .galaxy-page {
        min-height: 100vh;
        background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
        color: white;
    }
    
    .galaxy-header {
        text-align: center;
        padding: 2rem 1rem;
        background: rgba(0, 0, 0, 0.3);
    }
    
    .galaxy-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        background: linear-gradient(45deg, #64b5f6, #42a5f5);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .galaxy-header p {
        font-size: 1.1rem;
        color: #b0b0b0;
    }
    
    .galaxy-container {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 1rem;
        padding: 1rem;
        min-height: 600px;
    }
    
    #galaxy-renderer {
        background: #000011;
        border-radius: 8px;
        border: 2px solid #333;
        min-height: 600px;
    }
    
    .galaxy-controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .control-panel,
    .star-systems-list {
        background: rgba(0, 0, 0, 0.6);
        border-radius: 8px;
        padding: 1rem;
        border: 1px solid #333;
    }
    
    .control-panel h3,
    .star-systems-list h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        color: #64b5f6;
        font-size: 1.1rem;
    }
    
    .control-group {
        margin-bottom: 1rem;
    }
    
    .control-group label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        cursor: pointer;
    }
    
    .control-group input[type="checkbox"] {
        accent-color: #64b5f6;
    }
    
    .control-group input[type="range"] {
        width: 100%;
        margin: 0.5rem 0;
        accent-color: #64b5f6;
    }
    
    #distance-value {
        font-size: 0.8rem;
        color: #b0b0b0;
    }
    
    .system-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .system-button {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #444;
        border-radius: 4px;
        padding: 0.75rem;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .system-button:hover {
        background: rgba(100, 181, 246, 0.2);
        border-color: #64b5f6;
    }
    
    .system-button.active {
        background: rgba(100, 181, 246, 0.3);
        border-color: #64b5f6;
    }
    
    .system-name {
        font-weight: 500;
    }
    
    .system-distance {
        font-size: 0.8rem;
        color: #b0b0b0;
    }
    
    .galaxy-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.3);
    }
    
    .info-section h2 {
        color: #64b5f6;
        margin-bottom: 1rem;
    }
    
    .info-section p,
    .info-section li {
        line-height: 1.6;
        color: #d0d0d0;
    }
    
    .info-section ul {
        padding-left: 1.5rem;
    }
    
    .info-section li {
        margin-bottom: 0.5rem;
    }
    
    /* Responsive design */
    @media (max-width: 1024px) {
        .galaxy-container {
            grid-template-columns: 1fr;
            grid-template-rows: 500px auto;
        }
        
        .galaxy-controls {
            flex-direction: row;
            overflow-x: auto;
        }
        
        .control-panel,
        .star-systems-list {
            min-width: 250px;
        }
    }
    
    @media (max-width: 768px) {
        .galaxy-header h1 {
            font-size: 2rem;
        }
        
        .galaxy-info {
            grid-template-columns: 1fr;
            gap: 1rem;
            padding: 1rem;
        }
        
        .galaxy-controls {
            flex-direction: column;
        }
        
        #galaxy-renderer {
            min-height: 400px;
        }
    }
</style>
  </body>
</html>
